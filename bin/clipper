#!/bin/sh -eu

# ====== 変数の設定 ======
# ロケールの設定
export LC_ALL=C
export LANG=C

# ".abcde.conf"があれば真
if [ -e "${HOME}"/.abcde.conf ] ; then

	# 設定ファイルの変数を読み込み
	. "${HOME}/.abcde.conf"

else

	export ALBUMARTFILE="Folder.jpg"
	export OUTPUTDIR="${PWD}"

fi

# 実行時点のディレクトリ
pre_dir="${PWD}"

# 引数で指定されたディレクトリ
working_dir="${*}"

#引数があれば真
if [ -n "${working_dir}" ] ; then

	cd "${working_dir}"

else

	cd "${OUTPUTDIR}"

fi

# カバーアートのディレクトリ
coverart="albumart_backup"
# ====== 変数の設定ここまで ======


# 非対話的に処理,カバーアートを取得,ファイルに埋め込み
abcde -N -G -B &&

# カバーアートのパスに移動
coverart_dir=$(find "${PWD}" -d -name "${coverart}" 2> /dev/null)
cd "${coverart_dir}"

mv "${ALBUMARTFILE}" ../

cd ../

rmdir "${coverart}" ;

cd "${pre_dir}"

