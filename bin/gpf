#!/bin/sh

set -eu

# コマンドの存在確認関数
check_command(){

	# 第1引数として与えられたコマンドの有無を確認,第2引数のメッセージを表示
    if ! command -v "${1}" > /dev/null; then

        cat <<- EOS >&2
		${1} is not installed or not in PATH.
		Please install $1 and try again.
		${2}
		EOS

        exit 1

    fi

}

# geminiとfzfの存在確認
check_command "gemini" "npx https://github.com/google-gemini/gemini-cli or npm install -g @google/gemini-cli"
check_command "fzf" "sudo apt install fzf"

# メニュー項目の定義
menu_items=$(cat <<- EOS
1:git commitの作成
2:git commitの打ち消し
3:READMEへの反映
4:READMEを添削
EOS
)

# 選択処理
selected=$(echo "${menu_items}" | fzf --layout=reverse --prompt="操作を選択 > " | cut -d":" -f1)

# 選択処理で受け取った変数に応じプロンプトを変数に代入
case "${selected}" in

    1)
        message="gitから変更点を確認し適切なコミットを作成してください.コミットの作成時に許可を得る必要はありません"
        ;;
	2)
		message="1つ前のgit commitを打ち消してください.操作時に許可は不要です"
		;;
    3)
        message="gitの履歴を確認し必要であれば@README.mdに追記してください"
        ;;
    4)
        message="@README.mdの内容を添削し変更点を別ファイルに書き出してください"
        ;;
    *)
        exit 1
        ;;

esac

# gemini-cliに処理を依頼,非対話モードかつ自律モードを有効化
gemini --yolo -p "${message}"

