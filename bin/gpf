#!/bin/sh

set -eu

# gemini-cliの有無を確認
if ! command -v gemini > /dev/null; then

	# ヒアドキュメントでエラーメッセージを表示
	cat <<- EOS >&2
    gemini is not installed or not in PATH.
	Please install gemini and try again.
	$ npx https://github.com/google-gemini/gemini-cli
	or
	$ npm install -g @google/gemini-cli
	EOS

	exit 1

fi

# fzfの有無を確認
if ! command -v fzf > /dev/null; then

	cat <<- EOS >&2
	fzf is not installed or not in PATH.
	Please install fzf and try again.
	$ sudo apt install fzf
	EOS

	exit 1

fi

# メニュー項目の定義
menu_items=$(cat <<- EOS
1:git commitの作成
2:READMEへの反映
3:READMEを添削
EOS
)

# 選択処理
selected=$(echo "${menu_items}" | fzf --reverse --prompt="操作を選択 > " | cut -d":" -f1)

# 選択処理で受け取った変数に応じプロンプトを変数に代入
case "${selected}" in

    1)
        message="gitから変更点を確認し適切なコミットを作成してください。コミットの作成時に許可を得る必要はありません"
        ;;
    2)
        message="gitから変更点を確認し必要であればREADME.mdに追記してください"
        ;;
    3)
        message="README.mdの内容を添削し変更点を別ファイルに書き出してください"
        ;;
    *)
        exit 1
        ;;

esac

# gemini-cliに処理を依頼,非対話モードかつ自律モードを有効化
gemini --yolo -p "${message}"

